<% content_for :title, "Users" %>

<div class="user-directory">
  <% if notice.present? %>
    <p class="user-directory-notice" id="notice"><%= notice %></p>
  <% end %>

  <div class="user-directory-header">
    <div>
      <h1 class="user-directory-title">Community</h1>
      <p class="user-directory-subtitle">Discover writers, commenters, and fellow readers</p>
    </div>

    <%= link_to "Create user", new_user_path, class: "btn-primary" %>
  </div>

  <div class="user-search-panel">
    <%= form_with url: users_path, method: :get, local: true, class: "user-search-form" do |form| %>
      <div class="user-search-field">
        <%= form.label :q, "Search people", class: "user-search-label" %>
        <%= form.text_field :q, value: @query, placeholder: "Search by name or email...", class: "user-search-input" %>
      </div>
      <div class="user-search-actions">
        <%= form.submit "Search", class: "btn-secondary" %>
        <% if @query.present? %>
          <%= link_to "Clear", users_path, class: "btn-outline" %>
        <% end %>
      </div>
    <% end %>
    <div class="user-search-meta">
      <span><%= pluralize(@users.size, "result") %></span>
      <% if @query.present? %>
        <span class="user-search-query">for “<%= @query %>”</span>
      <% end %>
    </div>
  </div>

  <div id="users" class="user-grid">
    <% if @users.any? %>
      <% @users.each do |user| %>
        <article class="user-card">
          <div class="user-card-header">
            <div class="user-card-avatar"><%= (user.name.presence || user.email).first.upcase %></div>
            <div>
              <h2 class="user-card-name"><%= link_to user.name, user %></h2>
              <p class="user-card-email"><%= user.email %></p>
            </div>
          </div>

          <% if user.bio.present? %>
            <p class="user-card-bio"><%= truncate(user.bio, length: 120) %></p>
          <% else %>
            <p class="user-card-bio user-card-bio--empty">No bio yet.</p>
          <% end %>

          <div class="user-card-stats">
            <div>
              <span class="user-card-stat-value"><%= user.posts.count %></span>
              <span class="user-card-stat-label">Posts</span>
            </div>
            <div>
              <span class="user-card-stat-value"><%= user.followers.count %></span>
              <span class="user-card-stat-label">Followers</span>
            </div>
            <div>
              <span class="user-card-stat-value"><%= user.following.count %></span>
              <span class="user-card-stat-label">Following</span>
            </div>
          </div>

          <div class="user-card-actions">
            <%= link_to "View profile", user, class: "btn-secondary" %>
            <% if current_user == user %>
              <%= link_to "Edit profile", edit_user_path(user), class: "btn-outline" %>
            <% else %>
              <%= render "users/follow_button", user: user %>
            <% end %>
          </div>
        </article>
      <% end %>
    <% else %>
      <div class="user-directory-empty">
        <p>No people found.</p>
        <% if @query.present? %>
          <p class="user-directory-empty-sub">Try a different search term.</p>
        <% end %>
      </div>
    <% end %>
  </div>
</div>
