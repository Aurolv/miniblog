<article id="<%= dom_id(post) %>" class="post-preview">
  <header class="post-preview-header">
    <div class="post-preview-author">
      <% if post.user %>
        <%= link_to post.user do %>
          <div class="post-preview-avatar"><%= (post.user.name.presence || post.user.email).first.upcase %></div>
        <% end %>
        <div>
          <p class="post-preview-author-name"><%= link_to(post.user.name, post.user) %></p>
          <p class="post-preview-author-meta">
            <%= post.published? ? l(post.published_at || post.created_at, format: :short) : "Draft" %>
          </p>
        </div>
      <% else %>
        <div class="post-preview-avatar">U</div>
        <div>
          <p class="post-preview-author-name">Unknown author</p>
          <p class="post-preview-author-meta"><%= l(post.created_at, format: :short) %></p>
        </div>
      <% end %>
    </div>
  </header>

  <% if post.image.attached? %>
    <div class="post-preview-cover">
      <%= image_tag url_for(post.image), class: "post-preview-image", alt: post.title %>
    </div>
  <% end %>

  <div class="post-preview-body">
    <h2><%= link_to post.title, post %></h2>
    <p><%= truncate(post.body, length: 180) %></p>
  </div>

  <footer class="post-preview-footer">
    <div class="post-preview-stats">
      <span><strong><%= post.comments.count %></strong> comments</span>
      <span><strong><%= post.likes.count %></strong> likes</span>
    </div>
    <div class="post-preview-actions">
      <%= link_to "Read", post, class: "btn-secondary" %>
      <% if current_user && owner?(post) %>
        <%= link_to "Edit", edit_post_path(post), class: "btn-outline" %>
        <% unless post.published? %>
          <%= button_to "Publish", publish_post_path(post), method: :patch, class: "btn-primary",
                form: { data: { turbo_confirm: "Publish this draft?" } } %>
        <% end %>
      <% end %>
      <% if current_user && owns?(post) %>
        <%= button_to post_path(post), method: :delete, class: "btn-danger",
              data: { turbo_confirm: "Delete this post?" } do %>
          Delete
        <% end %>
      <% end %>
    </div>
  </footer>
</article>
